define(["infinite","common","ads","custom","newsletter"],(function(infinite,common,ads,custom,newsletter){console.log(typeof infinite);let sectionApiUrl="",galleryApiUrl="",storyArr,galleryArr,nextUrls=[],mainSecUrl="";var infiniteCall=!1;function loadInfiniteStories(){if(void 0!==$("#dataHolder").attr("data-story-id")){let id=$("#dataHolder").attr("data-story-id"),section=$("#dataHolder").attr("data-story-section"),subSection=$("#dataHolder").attr("data-story-subsection");if(sectionUrl=section.replace(/ /g,"-"),""!=subSection&&(sectionUrl+="/"+subSection.replace(/ /g,"-")),sectionApiUrl=apiBaseUrl+"section/"+sectionUrl.toLowerCase()+"?page=1&size=10&story-only=true&storyid="+id,"india news"==section.replace("-"," ")||"world news"==section.replace("-"," ")||"entertainment"==section){mainSecUrl=webbaseUrl+"/"+sectionUrl.toLowerCase();let urlObj={};urlObj.url=mainSecUrl,urlObj.title="Section Page",urlObj.id=1,urlObj.section=section,urlObj.author="",urlObj.premium="",urlObj.type="sectionPage",nextUrls.push(urlObj),getNextPage()}else if("lifestyle"==section||"sports"==section||"cricket"==section){let photoSection=section;"sports"!=section&&"cricket"!=section||(photoSection="sports"),sectionApiUrl=apiBaseUrl+"section/"+sectionUrl.toLowerCase()+"?page=1&size=10&story-only=true&storyid="+id,galleryApiUrl=apiBaseUrl+"section/photos/"+photoSection+"?page=1&size=5&story-only=true&storyid="+id,$.when($.get(sectionApiUrl,(function(res){storyArr=res.content.filter(item=>"story"==item.type),storyArr=storyArr.slice(0,5)}),"json"),$.get(galleryApiUrl,(function(res){galleryArr=res.content.filter(item=>"gallery"==item.type)}),"json")).then((function(){let n1=galleryArr.length,n2=storyArr.length,arr3=new Array(n1+n2);mergeResponse(galleryArr,storyArr,n1,n2,arr3)})),$(document).on("click",".showText",(function(e){$(this).prev().toggleClass("shortText"),$(this).html("")}))}else $.when($.get(sectionApiUrl,(function(res){storyArr=null==res.content?JSON.parse(res).content:res.content}))).then((function(){galleryArr=[];let n1=galleryArr.length,n2=storyArr.length,arr3=new Array(n1+n2);mergeResponse(galleryArr,storyArr,n1,n2,arr3)}))}}function mergeResponse(arr1,arr2,n1,n2,arr3){let i=0,j=0,k=0;for(;i<n1&&j<n2;)arr3[k++]=arr1[i++],arr3[k++]=arr2[j++];for(;i<n1;)arr3[k++]=arr1[i++];for(;j<n2;)arr3[k++]=arr2[j++];arr3.forEach(item=>{let premiumStory=!1;item.metadata.premiumStory&&(premiumStory=!0);let urlObj={};urlObj.url=webbaseUrl+item.metadata.url,urlObj.title=item.mobileHeadline,urlObj.id=item.id,urlObj.section=item.metadata.section,urlObj.author=item.metadata.authorsString,urlObj.premium=premiumStory,urlObj.type=item.type,nextUrls.push(urlObj)}),getNextPage()}function getNextPage(){let infScroll=new infinite(".detailPage",{path:function(){var nextUrl=nextUrls[this.loadCount];if(nextUrl)return nextUrl.url},append:".fullStory, .photoGallerySec, .listingPage",status:".loader-ellips",hideNav:".pagination",loadOnScroll:!0,scrollThreshold:2e3});function showBackNextBtn(){infScroll.loadNextPage(),$("#btndiv").show(),common.getCookie("hideCoachmark")?$(".overlay__story, .storyInfo__box").hide():$(".overlay__story, .storyInfo__box").show(),$(".storyInfo__box .btn").on("click",(function(){ga("send","event","Article Interaction","Done",""),common.setCookie("hideCoachmark",!0,1),$(".overlay__story, .storyInfo__box").hide()}));let nextCount=1;$(".storybtn").on("click",(function(e){let i=$(this).attr("id");if(e.preventDefault(),$(".overlay__story, .storyInfo__box").hide(),common.setCookie("hideCoachmark",!0,1),"next"===i&&$(".current").nextAll(".photoGallerySec,.fullStory").length>0){nextCount++;let $next=$(".current").nextAll(".photoGallerySec,.fullStory").first(),nextUrl=webDomainURL+$next.find(".photoGallery").first().data("url");ga("set","dimension49","gallery"),ga("set","dimension53",nextCount),ga("send","event","Article Interaction","Next_story_click",nextUrl),$(".current").removeClass("current"),$next.addClass("current"),$("html, body").animate({scrollTop:$next.offset().top-100},3e3),infScroll.loadNextPage()}else if("prev"===i&&$(".current").prevAll(".photoGallerySec,.fullStory").length>0){nextCount--;let $prev=$(".current").prevAll(".photoGallerySec,.fullStory").first();console.log($prev);let prevUrl=webDomainURL+$prev.find(".photoGallery").first().data("url");ga("set","dimension49","gallery"),ga("set","dimension53",nextCount),ga("send","event","Article Interaction","Previous_story_click",prevUrl),$(".current").removeClass("current"),$prev.addClass("current"),$("html, body").animate({scrollTop:$prev.offset().top-200},3e3)}$(".current").prevAll(".photoGallerySec,.fullStory").first().length>0?$(".prev__btn").css("display","block"):$(".prev__btn").css("display","none");let lastScrollTop=0;$(window).on("scroll",()=>{let st=$(window).scrollTop();st<lastScrollTop&&$(".breadcrumbs").first().isInViewport()&&$(".prev__btn").css("display","none"),lastScrollTop=st})}))}isMobile&&showBackNextBtn(),infScroll.on("append",(function(response,path,items){$(items).removeClass("current"),$(items).hasClass("listingPage")||$(items).prepend('<fieldset class="next_story"><legend>Next Story</legend><img src="/res/images/white---down-_1.gif" alt=""></fieldset>');let obj={},storyId=nextUrls[this.loadCount-1].id,type=nextUrls[this.loadCount-1].type;if(obj.id=storyId,"sectionPage"==type)custom.changeUrl_ForSection($(items)),ads.getNativeAds($(items)),custom.getLazyImage();else if("gallery"==type){if($("#gallerycss").length<1){let link=document.createElement("link");link.id="gallerycss",link.rel="stylesheet",link.type="text/css",link.href="/res/css/photo-gallery.css?v=12",document.getElementsByTagName("head")[0].appendChild(link)}custom.changeUrl($(items),"gallery"),ads.getNativeGalleryAds($(items)),custom.getLazyImage()}else{ads.getNativeStoryAds($(items),!1,!0),custom.getStoriesFromRFU($(items),obj),window.OBR&&OBR.extern.researchWidget();let isInsta=$(items).find(".ht-instagram-embed").length>0,isTwitter=$(items).find(".ht-twitter-embed").length>0;if(isInsta){let instagramScript=document.createElement("script");instagramScript.src="https://www.instagram.com/embed.js",instagramScript.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(instagramScript),window.instgrm&&window.instgrm.Embeds&&window.instgrm.Embeds.process()}if(isTwitter){let twitterScript=document.createElement("script");twitterScript.src="https://platform.twitter.com/widgets.js",twitterScript.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(twitterScript),window.twttr&&window.twttr.widgets&&window.twttr.widgets.load()}common.getCookie("token")&&common.getCookie("_ht_clientid")&&custom.checkSubscription(),newsletter.initNewsletterWidget(storyId)}})),infScroll.on("history",(function(title,path){document.title=title;let storyItem=nextUrls[this.loadCount-1];dataLayer.push({event:"perpetual_scroll",eventCategory:"Perpetual Scroll",eventAction:this.loadCount,eventLabel:path,pageType:storyItem.type}),common.sendPageView(storyItem.id,storyItem.title,storyItem.section,storyItem.author,storyItem.premium.toString())}))}$(window).scroll((function(event){$(window).scrollTop()>500&&(infiniteCall||(loadInfiniteStories(),infiniteCall=!0))}))}));