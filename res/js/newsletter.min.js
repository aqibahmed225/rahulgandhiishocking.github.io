define(["customDropDown","common","jqueryui","custom"],(function(customDropDown,common,jqueryui,custom){var newsletter={},current_page=1;const records_per_page=10,days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months=["january","february","march","april","may","june","july","august","september","october","november","december"];function firstPage(){current_page>1&&(current_page=1,changePage(1))}function prevPage(){current_page>1&&changePage(--current_page)}function nextPage(){current_page<numPages()&&changePage(++current_page)}function lastPage(){current_page<numPages()&&(current_page=numPages(),changePage(numPages()))}function getLastDayOccurence(day,date){const d=new Date(date.getTime());if(d.getDay()!=days.indexOf(day)&&days.includes(day)){const modifier=(d.getDay()+days.length-days.indexOf(day))%7||7;d.setDate(d.getDate()-modifier)}return d}var json={};function getFormatedDate(dateInput){var dt=new Date(dateInput);let date,month,year;var formattedDate;return(dt.getDate()<10?"0"+dt.getDate():dt.getDate())+"-"+(dt.getMonth()+1<10?"0"+(dt.getMonth()+1):dt.getMonth()+1)+"-"+dt.getFullYear().toString().substring(2)}function getFormatedDateForLetter(dateInput){var dt=new Date(dateInput);let date,month,year;var formattedDate;return(dt.getDate()<10?"0"+dt.getDate():dt.getDate())+""+(dt.getMonth()+1<10?"0"+(dt.getMonth()+1):dt.getMonth()+1)+dt.getFullYear()}function getFormatedDateForCalendar(dateInput){var dt=new Date(dateInput);let date=dt.getDate()<10?"0"+dt.getDate():dt.getDate(),month,year;var formattedDate;return(dt.getMonth()+1<10?"0"+(dt.getMonth()+1):dt.getMonth()+1)+"-"+date+"-"+dt.getFullYear()}function getFormatedDateForUrl(dateInput){var dt=new Date(dateInput);let date,month,year;var formattedDate;return(dt.getDate()<10?"0"+dt.getDate():dt.getDate())+"-"+months[dt.getMonth()]+"-"+dt.getFullYear()}function getDateFromFormattedDate(dateInput){let date=dateInput.substring(0,2),month=dateInput.substring(2,4),year=dateInput.substring(4);var dt;return new Date(year,month-1,date)}function getDate(dateInput){let array=dateInput.split("-"),date=array[0],month=months.indexOf(array[1]),year=array[2];var dt;return new Date(year,month,date)}function dateDiffInDays(a,b){const utc1=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),utc2=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((utc2-utc1)/864e5)}const pageGroup=3;let pageIndex=1;function changePage(page){if(page<1&&(page=1),page>numPages()&&(page=numPages()),pageIndex=page>3?page-3:1,numPages()>1){let pageHtml="";pageHtml+="<div class='listPagination'>",pageHtml+="<ul>",pageHtml+="<li class='first disabled'</li>",pageHtml+="<li class='previous disabled'></li>";for(let pageNo=pageIndex;pageNo<=numPages();pageNo++)pageNo==page?pageHtml+="<li class='active' id='"+pageNo+"'>"+pageNo+"</li>":(page>3&&pageNo<=page||pageNo<=3)&&(pageHtml+="<li id='"+pageNo+"'><a href='javascript:void(0);' class='changePage' page-number='"+pageNo+"'>"+pageNo+"</a></li>");numPages()>3&&page!=numPages()&&(pageHtml+="<li><span>...</span></li>"),pageHtml+="<li class='next'><a href='javascript:void(0);' id='nextPage'></a></li>",pageHtml+="<li class='last'><a href='javascript:void(0);' id='lastPage'></a></li>",pageHtml+="</ul>",pageHtml+="</div>",$("#pagination").html(pageHtml)}else $("#pagination").html("");if(page>3)for(let pageNum=1;pageNum<=page-3;pageNum++)$("li#"+pageNum).remove();$(".news_contaner .list_view").find($(".news_items.items")).remove();for(var i=10*(page-1);i<10*page;i++)$(".news_contaner .list_view").append(objArray[i]);previewClick(),$(".all_news_head").find("span").text("("+objArray.length+")"),page>1?$(".pageName").first().html("PAGE "+page):$(".pageName").first().html(""),1==page?(hidePrev(),showNext()):page==numPages()?(showPrev(),hideNext()):(showPrev(),showNext()),current_page=page,$(".changePage").each((function(i,el){let elemId=$(el).attr("page-number");$("#"+elemId).on("click",(function(){changePage(elemId)}))}))}function showNext(){$(".last").removeClass("disabled").html("<a href='javascript:void(0);' id='lastPage'></a>"),$(".next").removeClass("disabled").html("<a href='javascript:void(0);' id='nextPage'></a>"),$("#nextPage").on("click",(function(){nextPage()})),$("#lastPage").on("click",(function(){lastPage()}))}function showPrev(){$(".first").removeClass("disabled").html("<a href='javascript:void(0);' id='firstPage'></a>"),$(".previous").removeClass("disabled").html("<a href='javascript:void(0);' id='prevPage'></a>"),$("#prevPage").on("click",(function(){prevPage()})),$("#firstPage").on("click",(function(){firstPage()}))}function hideNext(){$(".next").addClass("disabled").html(""),$(".last").addClass("disabled").html("")}function hidePrev(){$(".first").addClass("disabled").html(""),$(".previous").addClass("disabled").html("")}function numPages(){return Math.ceil(objArray.length/10)}function getDayForGivenDate(date){return days[date.getDay()]}var currentDate=new Date($(".all_news_filter").attr("date"));function ajaxCall(){let url="https://www.hindustantimes.com/static-content/newsletters/qa/newsletter-archives.json";"www.hindustantimes.com"!=window.location.hostname.toString()&&"preprod-www.hindustantimes.com"!=window.location.hostname.toString()||(url="https://www.hindustantimes.com/static-content/newsletters/newsletter-archives.json"),$.ajax({url:url,type:"GET",dataType:"json",async:!1,success:function(res){json=res,loadInitialData(),json.newsletters.forEach(item=>{Object.assign(jsonMap,{[item.id]:item})}),$(".newsletter-detail").each((function(){setCalendar(),getIframe()}))}})}function getTruncateNewsletterName(name){let charLimit=isDeviceEnabled("small")?9:18,newsletterName=name;return newsletterName.length>charLimit&&(newsletterName=newsletterName.substring(0,charLimit-1)+"..."),newsletterName}function initDropdown(dropdown){$(dropdown).on("click",(function(e){"newsletter-label"!=e.target.className&&"dropdown storyNL"!=e.target.className||$(dropdown).find($("ul")).toggle()})),$(dropdown).find($("ul li")).on("click",(function(){let labelName=$(this).find("label"),inputElem=$(this).find("input"),subButton=$(this).parent().parent().parent().parent().find("button");$(subButton).removeAttr("disabled"),"all-news"==$(labelName).attr("for")?($(labelName).removeClass("not__all__selected"),$('input[type="checkbox"]:enabled').prop("checked",$(inputElem).is(":checked")),$(inputElem).is(":checked")||$(subButton).attr("disabled","disabled")):$(".allNews").parent().find("label").addClass("not__all__selected");var label=$(this).parent().parent().children(".newsletter-label");label.attr("data-value",$(this).attr("data-value")),label.attr("data-name",$(this).find("label").html());let selectedNewsletters=$(this).parent().find("input:checked");selectedNewsletters=selectedNewsletters.filter((function(){return!$(this).hasClass("allNews")}));let totalNewsletters=$(this).parent().find('input[type="checkbox"]:enabled');"all-news"==$(labelName).attr("for")&&$(inputElem).is(":checked")?label.html("All Newsletters"):1==selectedNewsletters.length?label.html($(selectedNewsletters).parent().find("label").html()):selectedNewsletters.length<=totalNewsletters.length-2?(label.html(selectedNewsletters.length+" selected"),0==selectedNewsletters.length&&$(subButton).attr("disabled","disabled")):label.html("All Newsletters"),selectedNewsletters.length==totalNewsletters.length-1&&$(".allNews").parent().find("label").removeClass("not__all__selected")}))}function getNewslettersData(articleId,subscribedNewsletters=[]){try{let url="https://www.hindustantimes.com/static-content/newsletters/qa/newsletter-archives.json";"www.hindustantimes.com"!=window.location.hostname.toString()&&"preprod-www.hindustantimes.com"!=window.location.hostname.toString()||(url="https://www.hindustantimes.com/static-content/newsletters/newsletter-archives.json"),$.ajax({url:url,type:"GET",dataType:"json",success:function(res){let newsletters=res.newsletters.filter(n=>n.active),finalNewsletters=newsletters,unsubscribedNewslettersList=[];if(subscribedNewsletters.length){let subscribedNewslettersList=newsletters.filter(n=>subscribedNewsletters.includes(n.alternativeId));unsubscribedNewslettersList=newsletters.filter(n=>!subscribedNewsletters.includes(n.alternativeId)),finalNewsletters=unsubscribedNewslettersList.concat(subscribedNewslettersList)}let sectionName=$("#dataHolder").data("story-section").replace(" ","-"),dropdown=$(".select__newsletter").find($("[data-articleid="+articleId+"]"));finalNewsletters.forEach((function(newsletter,i){"htdailycapsule"==newsletter.id?$(dropdown).find("ul").append("<li data-value='"+newsletter.alternativeId+"' id='"+newsletter.alternativeId+"' data-img='"+newsletter.imagePath+"' data-summary='"+newsletter.summary+"' data-name='HT Daily Capsule'><div class='form-group'><input type='checkbox' id='news"+(i+1)+"'><label for='news"+(i+1)+"' data-value='"+newsletter.alternativeId+"'>HT Daily Capsule</label><p>"+newsletter.summary+"</p></div></li>"):$(dropdown).find("ul").append("<li data-value='"+newsletter.id+"' id='"+newsletter.id+"' data-img='"+newsletter.imagePath+"' data-summary='"+newsletter.summary+"' data-name='"+newsletter.name+"'><div class='form-group'><input type='checkbox' id='news"+(i+1)+"'><label for='news"+(i+1)+"' data-value='"+newsletter.id+"'>"+newsletter.name+"</label><p>"+newsletter.summary+"</p></div></li>")}));let selectedNewsletter=$("[id="+res.sections[sectionName]+"]").not(".selected");if((null==res.sections[sectionName]||subscribedNewsletters.length&&subscribedNewsletters.includes(res.sections[sectionName]))&&(selectedNewsletter=unsubscribedNewslettersList.length>0?$("[id="+unsubscribedNewslettersList[0].id+"]"):[]),selectedNewsletter.length)$(selectedNewsletter).each((function(i,el){$(el).addClass("selected"),$(el).find("input").prop("checked",!0),$(dropdown).find(".newsletter-label").text($(el).find("label").html()),$(dropdown).find(".newsletter-label").attr("data-value",$(el).attr("data-value")),$(dropdown).find(".newsletter-label").attr("data-name",$(el).find("label").html())}));else{let defaultNL=$("[id=dailynewscapsule]");$(defaultNL).addClass("selected"),$(defaultNL).find("input").prop("checked",!subscribedNewsletters.length||unsubscribedNewslettersList.length>0)}subscribedNewsletters.forEach(item=>{let element=$("[id="+item+"]");$(element).each((function(i,elm){$(elm).find("label").addClass("disabled__checkbox"),$(elm).find("label").html($(elm).find("label").text()+" <img src='/res/images/subscribed-btn.svg'>"),$(elm).find("input").attr("disabled","disabled")}))}),initDropdown(dropdown)}})}catch(ex){console.error(ex)}}var newslettersAll=[],dayDifference=7,newslettersObject={};function loadInitialData(){json.newsletters.forEach(item=>{$("#sources-topic").append("<option value='"+item.id+"'>"+item.name+"</option>")}),json.newsletters.forEach(item=>{let html="<span class='custom-option' id='"+item.id+"' data-value="+item.id+">"+item.name+"</span>";$("#sources-topic").parent().find(".custom-options").append(html)}),$(".custom-option").on("click",(function(){$(this).parents(".custom-select-wrapper").find("select").val($(this).data("value")),$(this).parents(".custom-options").find(".custom-option").removeClass("selection"),$(this).addClass("selection"),$(this).parents(".custom-select").removeClass("opened"),$(this).parents(".custom-select").find(".custom-select-trigger").text($(this).text())})),loadData(),$("#sources-topic").parent().find(".custom-options").each((function(i,el){$(el).on("click",(function(e){let value=e.target.id;loadData();let newsletter=newslettersObject[value]||[];objArray="all"==value?newslettersAll:newsletter,changePage(1)}))})),$("#sources_date_filter").parent().find(".custom-options").each((function(i,el){$(el).on("click",(function(e){let value=e.target.id,selectedNewsletter;dayDifference="all"==value?0:value,loadData($(".typeFiler .custom-options .selection").data("value")),changePage(1)}))})),changePage(1)}function loadData(newsletterType=""){newslettersObject={},newslettersAll=[],"all"==newsletterType||""==newsletterType?json.newsletters.forEach(item=>{getData(item)}):null!=newsletterType&&getData(jsonMap[newsletterType]),newslettersAll=newslettersAll.sort((function(a,b){let date1=$(a).children().attr("date"),date2;return getDate($(b).children().attr("date"))-getDate(date1)})),objArray=newslettersAll}function getData(item){let lastPublishedDate=""!=item.lastPublishedDate?new Date(item.lastPublishedDate):"";(""==lastPublishedDate||lastPublishedDate>currentDate)&&(lastPublishedDate=currentDate);let dateCounter=currentDate,difference=dayDifference,object=[],firstPublishedDate=new Date(item.firstPublishedDate);if(0==dayDifference){difference=dateDiffInDays(firstPublishedDate,lastPublishedDate),dateCounter=lastPublishedDate;for(let i=0;i<=difference;i++)getJsonData(newslettersObject,item,object,dateCounter),dateCounter=new Date(dateCounter.getTime()-864e5)}let tempDate=new Date;if(tempDate.setDate(tempDate.getDate()-dayDifference),0!=dayDifference&&lastPublishedDate>=tempDate){let d=dateDiffInDays(firstPublishedDate,lastPublishedDate);difference=difference>d?d:difference;for(let i=0;i<=difference;i++)getJsonData(newslettersObject,item,object,dateCounter),dateCounter=new Date(dateCounter.getTime()-864e5)}}function previewClick(){$(".news_letter").each((function(i,el){let elemId=el.id;$("#"+elemId).on("click",(function(){openNewsletterInNewTab(el)}))}))}function openNewsletterInNewTab(el){let date=$(el).attr("date"),urlAppender=$(el).data("url");window.open(urlAppender+"/"+date,"_blank")}function getJsonData(newslettersObject,item,object,dateCounter){let publishDays=item.publishDays.split(","),currentDay=getDayForGivenDate(dateCounter);if(publishDays.includes(currentDay)){let formattedDate,newsItems=getNewsItemListing(item,getFormatedDateForUrl(dateCounter),dateCounter);object.push(newsItems),newslettersAll.push(newsItems),Object.assign(newslettersObject,{[item.id]:object})}return newslettersObject}function getNewsItemListing(news,formattedDate,date){let newsletter_type=news.name,newsItem="";return newsItem+="<div class='news_items items'>",newsItem+="<a href='javascript:void(0);' class='news_letter' data-url='"+news.urlAppender+"' date='"+formattedDate+"' newsletter_type='"+news.id+"' id='"+news.id+"-"+formattedDate+"-list'>",newsItem+="<div class='news_content_box'>",newsItem+="<div>",newsItem+="<h3>"+newsletter_type+"</h3>",newsItem+="</div>",newsItem+="<div class='published'>Published on <span>"+getFormatedDate(date)+"</span></div>",newsItem+="<div class='news_letter_preview'>Preview</div>",newsItem+="</div>",newsItem+="</a>",newsItem+="</div>",newsItem}$("#arrow").on("click",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?objArray.sort((function(a,b){let date1=$(a).children().attr("date"),date2=$(b).children().attr("date");return getDate(date1)-getDate(date2)})):objArray.sort((function(a,b){let date1=$(a).children().attr("date"),date2;return getDate($(b).children().attr("date"))-getDate(date1)})),changePage(1)}));let enableDays=[];function enableAllTheseDays(date){var sdate=$.datepicker.formatDate("mm-dd-yy",date);return-1!=$.inArray(sdate,enableDays)?[!0]:[!1]}function setCalendar(){let url=$("#newsletter-detail").data("url").replaceAll("-",""),object=jsonMap[url],startDate=new Date(object.firstPublishedDate),endDate=""==object.lastPublishedDate?new Date:new Date(object.lastPublishedDate),difference=dateDiffInDays(startDate,endDate),dateCounter=endDate;for(let i=0;i<=difference;i++){let publishDays=object.publishDays.split(","),currentDay=getDayForGivenDate(dateCounter);if(publishDays.includes(currentDay)){let formattedDate=getFormatedDateForCalendar(dateCounter);enableDays.push(formattedDate)}dateCounter=new Date(dateCounter.getTime()-864e5)}let lastDate=new Date(enableDays[0]);$("#datepicker").datepicker({dateFormat:"dd MM yy",minDate:startDate,maxDate:lastDate,beforeShowDay:enableAllTheseDays,onClose:function(){let selectedDate=new Date($(this).val());changeData(selectedDate),toggleButtonDisabled(selectedDate,startDate,lastDate)}});let tempDate=$("#newsletter-detail").attr("date"),date=""==tempDate?lastDate:getDateFromFormattedDate(tempDate);$("#datepicker").datepicker("setDate",date),$("#next-arrow").removeClass("disabled"),toggleButtonDisabled(date,startDate,lastDate)}function changeData(date){$("#datepicker").datepicker("setDate",date),$("#newsletter-detail").attr("date",getFormatedDateForLetter(date)),getIframe();let dateMeta=getFormatedDateForUrl(date);dateMeta=dateMeta.substring(0,3)+dateMeta.charAt(3).toUpperCase()+dateMeta.substring(4);let title=$("#newsletter-detail").data("title"),finalTitle=title.includes("Newsletter Archives")?title.replace("Newsletter Archives","| "+dateMeta):title.split("|")[0]+"| "+dateMeta+" | Hindustan Times";$(document).prop("title",finalTitle);let url="/newsletters/"+$("#newsletter-detail").data("url")+"/"+getFormatedDateForUrl(date);history.pushState("",finalTitle,url)}function toggleButtonDisabled(selectedDate,startDate,lastDate){selectedDate.getTime()==lastDate.getTime()&&selectedDate.getTime()==startDate.getTime()?($("#previous-arrow").addClass("disabled"),$("#next-arrow").addClass("disabled")):selectedDate.getTime()==lastDate.getTime()?$("#next-arrow").addClass("disabled"):selectedDate.getTime()==startDate.getTime()?$("#previous-arrow").addClass("disabled"):($("#next-arrow").removeClass("disabled"),$("#previous-arrow").removeClass("disabled"))}let subscribedList={};function validateAlreadySubscribed(item=$("#story-subscribe-newsletter").data("value")){null!=subscribedList[item]&&subscribedList[item]?($("#story-subscribe-newsletter").attr("disabled","disabled"),$("#story-subscribe-newsletter").addClass("disabled"),$("#user_email").attr("placeholder","Already Subscribed!!"),$("#user_email").attr("disabled",!0)):($("#story-subscribe-newsletter").removeAttr("disabled"),$("#story-subscribe-newsletter").removeClass("disabled"),$("#user_email").attr("placeholder","Enter Email Address"),$("#user_email").attr("disabled",!1))}var email,cookie_token=custom.getCookie("token");function initNewsletterWidget(articleId=""){cookie_token?(getEmailFromToken(cookie_token),getUserData(articleId),$(".follow-btn").each((function(i,el){$(el).click((function(){let newsletterType=$(this).data("value"),newsletters=[];newsletters.push(newsletterType);let eventAction=$(el).hasClass("active")?"unsubscribe":"subscribe";var payLoad;ga("send","event","ht_site",eventAction,newsletterType),postUserData(JSON.stringify({domain:"HT",userToken:cookie_token,googleCaptcha:"string",subscriptionTypes:newsletters}),el,email,!0,newsletterType,!0)}))})),$(".story-subscribe-newsletter").each((function(i,elm){$(elm).click((function(){let selectedNewsletters=$(elm).parent().parent().find($("input:checked")),newsletters=[];selectedNewsletters.each((function(i,item){let newsletterType=$(item).parent().find("label").attr("data-value");newsletters.push(newsletterType)}));let newslettersList="";newsletters.forEach((function(n,i){0!=i&&(newslettersList+=", "),newslettersList+=n})),ga("set","dimension53",newslettersList),ga("send","event","newsletter_subscribe","newsletter_subscribe_initiated","CTA",newslettersList);var payLoad={};let inputElm=$(this).parent().find("input");postUserData(payLoad=""==(email=$(inputElm).val())||$(inputElm).is(":disabled")?JSON.stringify({domain:"HT",userToken:cookie_token,googleCaptcha:"string",subscriptionTypes:newsletters}):JSON.stringify({domain:"HT",emailId:email,googleCaptcha:"string",skipCaptcha:!0,subscriptionTypes:newsletters}),this,email,!0,newslettersList)}))}))):($(".new__newsletter__signup").length&&getNewslettersData(articleId),$(".follow-btn").each((function(i,el){$(el).click((function(){let newsletterType=$(this).data("value");if($(el).hasClass("active"))$(".popup-modal.newsletter-signin").show();else{$(".popup-modal.newsletter").show(),$("#subscribe-btn").remove();let subButton="<button class='subscribe btn disabled' id='subscribe-btn' disabled='disabled' type='button'>SUBSCRIBE NOW</button>";$(".popup-modal.newsletter .modal").append(subButton),$("#subscribe-btn").data("value",newsletterType)}$("input[type='email']").on("input",(function(e){null!=(email=e.target.value)&&""!=email&&email.includes("@")?($("#subscribe-btn").removeAttr("disabled"),$("#subscribe-btn").removeClass("disabled"),$("#subscribe-btn").data("email",email)):""==email||($("#subscribe-btn").attr("disabled","disabled"),$("#subscribe-btn").addClass("disabled"))})),$("#subscribe-btn").click((function(event){let newsletterType=$(this).data("value");email=$(this).data("email")||"",$(el).hasClass("active")?unsubscribeNewsletter(newsletterType,el,email):subscribeNewsletter(newsletterType,el,email,[])}))}))})),$(".story-subscribe-newsletter").each((function(i,elm){$(elm).click((function(){let selectedNewsletters=$(elm).parent().parent().find($("input:checked")),newsletters=[];selectedNewsletters.each((function(i,item){let newsletterType=$(item).parent().find("label").attr("data-value");newsletters.push(newsletterType)}));let newslettersList="";newsletters.forEach((function(n,i){0!=i&&(newslettersList+=", "),newslettersList+=n})),email=$(this).parent().find("input").val(),ga("set","dimension53",newslettersList),ga("send","event","newsletter_subscribe","newsletter_subscribe_initiated","CTA",newslettersList),subscribeNewsletter(newslettersList,this,email,newsletters)}))})))}function getUserData(articleId){try{var subscribeurl=apiBaseUrl;$.ajax({url:subscribeurl+"newsletter/get-active-subscription?usertoken="+cookie_token,type:"GET",dataType:"json",success:function(res){Array.isArray(res.result)&&res.result.length>0?(res.result.forEach(item=>{$("#"+item).addClass("active"),$("#"+item).attr("value","Subscribed")}),$(".new__newsletter__signup").length&&getNewslettersData(articleId,res.result)):$(".new__newsletter__signup").length&&getNewslettersData(articleId)}})}catch(ex){console.error(ex)}}function postUserData(payLoad,el,email="",IsLoggedIn,newsletterType,isEmailNotRequired=!1){var mailformat=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;if(isEmailNotRequired||email.match(mailformat)){$("#emailerror-emailalreadyexists").hide();var subscribeurl=apiBaseUrl;let urlAppender=$(el).hasClass("active")?"newsletter/unsubscribe":"newsletter/subscribe";$.ajax({url:subscribeurl+urlAppender,type:"POST",data:payLoad,contentType:"application/json",dataType:"json",success:function(res){if(payLoad=JSON.parse(payLoad),!0===res.success){if(newsletters=[],$("input[type='email']").val(""),$("#subscribe-btn").attr("disabled","disabled"),$("#subscribe-btn").addClass("disabled"),$(".popup-modal.newsletter").hide(),$(el).hasClass("follow-btn")?($(el).toggleClass("active"),$(el).attr("value",$(el).hasClass("active")?"Subscribed":"Subscribe"),showToastMsgSubscribe($(el).hasClass("active")?"subscribe":"unsubscribe",el)):(showToastMsgSubscribe("subscribe",el,"Subscribed to newsletter successfully <a class='view-subscribe-list' href='/subscribe-newsletter'>VIEW</a>"),ga("set","dimension53",$(el).data("value")),ga("send","event","newsletter_subscribe","newsletter_subscribe_success","CTA",$(el).data("value"))),!email.includes("@htdigital.sso")){let title=$(el).data("name")||newsletterType,action=$(el).hasClass("active")?"Subscribe":"UnSubscribe";custom.addDapTracking(action,title,email),IsLoggedIn||custom.addDapTrackingLoggedOut(email)}}else!0===res.exceptionResponse.alreadySubscribed&&($("#emailerror-emailalreadyexists").length>0?($("#emailerror-emailalreadyexists").text("This email id already exists"),$("#emailerror-emailalreadyexists").show()):showToastMsgSubscribe("subscribe",el,"Already subscribed with this email id","invalid__email"))}})}else $("#emailerror-emailalreadyexists").length>0?($("#emailerror-emailalreadyexists").text("Invalid Email Id"),$("#emailerror-emailalreadyexists").show()):(showToastMsgSubscribe("subscribe",el,"Please enter valid email address","invalid__email"),ga("set","dimension53",$(el).data("value")),ga("send","event","newsletter_subscribe","newsletter_subscribe_failed","CTA",$(el).data("value")))}function subscribeNewsletter(value,el,email,newsletters){var payLoad;ga("send","event","ht_site","subscribe",value),0==newsletters.length&&newsletters.push(value),postUserData(JSON.stringify({domain:"HT",emailId:email,googleCaptcha:"string",skipCaptcha:!0,subscriptionTypes:newsletters}),el,email,!1,value)}function unsubscribeNewsletter(value,el,email){ga("send","event","ht_site","unsubscribe",value);var mailformat=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;if(email.match(mailformat)){$("#emailerror-emailalreadyexists").hide();let newsletters=[];var payLoad;return newsletters.push(value),postUserData(JSON.stringify({domain:"HT",emailId:email,googleCaptcha:"string",skipCaptcha:!0,subscriptionTypes:newsletters}),el,email,!1,value),!0}return $("#emailerror-emailalreadyexists").text("Invalid Email Id"),$("#emailerror-emailalreadyexists").show(),!1}$("#close-newsletter-popup").click((function(e){$("input[type='email']").val(""),$("#emailerror-emailalreadyexists").hide(),$(".popup-modal.newsletter").hide(),$("#subscribe-btn").attr("disabled","disabled"),$("#subscribe-btn").addClass("disabled")})),$("#close-newsletter-signin-popup").click((function(e){$(".popup-modal.newsletter-signin").hide()})),$(".newsletter-preview").each((function(i,el){$(el).click((function(){window.open($(el).data("url"),"_blank"),ga("send","event","ht_site","preview",$(el).data("value"))}))}));let showToastMsgSubscribe=function(action,el,msgHtml="",invalidEmailId=""){""==msgHtml&&("subscribe"==action?msgHtml="Newsletter subscribed successfully":"unsubscribe"==action&&(msgHtml="Newsletter unsubscribed successfully<a id='undo-unsubscribe' data-value='"+el.id+"'>UNDO</a>")),$("#toasts-sub").show();let newToast=document.createElement("div");$(newToast).addClass("toast-following show "+invalidEmailId),$(newToast).html(msgHtml),$("#toasts-sub").html(newToast),$("#undo-unsubscribe").click((function(e){let newsletterType=$(this).data("value");if(cookie_token){let newsletters=[];var payLoad;newsletters.push(newsletterType),ga("send","event","ht_site","subscribe",newsletterType),postUserData(JSON.stringify({domain:"HT",userToken:cookie_token,googleCaptcha:"string",subscriptionTypes:newsletters}),el,email,!0,newsletterType,!0)}else subscribeNewsletter(newsletterType,$("#"+newsletterType),email,newsletters)})),setTimeout((function(){$(newToast).removeClass("show"),$(newToast).addClass("showOut"),$(newToast).remove()}),3e3)};var jsonMap={};function getNewsletters(){json.newsletters.forEach(item=>{let html="",day;html+="<div class='"+item.type+"'>",html+="<form>",html+="<fieldset>",html+="<legend>"+(item.publishDays.split(",").length>1?"MONDAY-SUNDAY":item.publishDays)+"</legend>",html+="<div class='imgAndSubsBtn'>",html+="<div class='newsImg'>",html+="<img src='/res/images/newsLetter/HT_4_Daily_News_Capsule.svg'/>",html+="</div>",html+="<input type='button' id='dailynewscapsule' class='follow-btn followSM' data-value='dailynewscapsule' value='Subscribe'>",html+="</div>",html+="<div class='titleAndDesc'>",html+="<label class='chkbox'>"+item.name+"</label>",html+="<p>"+item.summary+"</p>",html+="</div>",html+="<div class='previewBtn'>",html+="<a href='javascript:void(0);' class='newsletter-preview' data-value='dailynewscapsule' data-url='https://www.hindustantimes.com'"+item.urlAppender+"'.html'>Preview</a>",html+="</div>",html+="</fieldset>",html+="</form>",html+="</div>",$(".subscList").append(html)})}function getTodayDate(){return new Date((new Date).setHours(0,0,0,0))}function getIframe(){let date=$("#newsletter-detail").attr("date"),url=$("#newsletter-detail").data("url").replaceAll("-",""),finalUrl=url;null!=date&&null!=date&&""!=date&&(finalUrl+=date);let urlAppender="ht-newsletter/";url.includes("covid")&&(urlAppender="ht-covid-newsletter/");let src="https://hindustantimes.com/"+urlAppender+finalUrl+".html";"https://hindustantimes.com"!=window.location.hostname.toString()&&(src=url.includes("covid")?"https://htcms-prod-images.s3.ap-south-1.amazonaws.com/ht/"+urlAppender+finalUrl+".html":"https://new-ht-images.s3.ap-south-1.amazonaws.com/static-content/"+urlAppender+finalUrl+".html");var iframe=document.createElement("IFRAME");iframe.setAttribute("src",src),iframe.setAttribute("height","2794"),iframe.setAttribute("width","100%"),$("#newsletter-detail").html(iframe)}function getEmailFromToken(userToken){try{$.ajax({url:apiBaseUrl+"subscription/fetch/userinfo?usertoken="+userToken,dataType:"json",type:"GET",success:function(res){void 0!==res.success&&res.success&&(email=res.data.secondaryEmail?res.data.secondaryEmail:res.data.email,$(".user_email").each((function(i,el){$(el).val(email),$(el).attr("disabled",!0)})))}})}catch(ex){console.error(ex)}}$("#previous-arrow").on("click",(function(){let newsletterType=$(this).data("value"),object=jsonMap[newsletterType],startDate=new Date(object.firstPublishedDate),lastDate=new Date(enableDays[0]),currentDate=new Date($("#datepicker").val());if(currentDate>startDate){let date=new Date(currentDate.getTime()-864e5),publishDays=object.publishDays.split(",");for(;!publishDays.includes(getDayForGivenDate(date));)date=new Date(date.getTime()-864e5);date>=startDate&&(changeData(date),toggleButtonDisabled(date,startDate,lastDate))}})),$("#next-arrow").on("click",(function(){let newsletterType=$(this).data("value"),object=jsonMap[newsletterType],startDate=new Date(object.firstPublishedDate),endDate=""==object.lastPublishedDate?getTodayDate():new Date(object.lastPublishedDate),lastDate=new Date(enableDays[0]),currentDate=new Date($("#datepicker").val());if(currentDate<endDate){let date=new Date(currentDate.getTime()+864e5),publishDays=object.publishDays.split(",");for(;!publishDays.includes(getDayForGivenDate(date));)date=new Date(date.getTime()+864e5);date<=endDate&&(changeData(date),toggleButtonDisabled(date,startDate,lastDate))}}));try{ajaxCall()}catch(ex){console.error(ex)}return newsletter.initNewsletterWidget=initNewsletterWidget,newsletter}));